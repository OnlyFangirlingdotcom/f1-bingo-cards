<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>F1 2026 Bingo - Player Card</title>
    <style>
        body { background:#000; color:#fff; font-family:Arial, sans-serif; text-align:center; margin:0; padding:20px; }
        h1 { color:#ff0000; margin-bottom:20px; }
        .grid { display:grid; grid-template-columns:repeat(5, 1fr); gap:8px; max-width:700px; margin:0 auto 30px; }
        .cell { background:#111; border:2px solid #ff0000; padding:15px; font-size:14px; font-weight:bold; cursor:pointer; transition:all 0.3s; min-height:80px; display:flex; align-items:center; justify-content:center; box-sizing:border-box; }
        .cell:hover { background:#222; transform:scale(1.05); }
        .marked { background:#00ff00 !important; color:#000; text-decoration:line-through; transform:scale(1.05); }
        #win { display:none; font-size:60pt; color:#ffd700; margin-top:30px; font-weight:bold; }
        button { background:#ff0000; color:white; border:none; padding:12px 30px; font-size:18px; cursor:pointer; margin:10px; border-radius:5px; }
        #stars { color:#ffd700; font-size:24pt; margin-top:20px; }
    </style>
</head>
<body>
    <h1>üèéÔ∏è F1 2026 BINGO - Player <span id="player">?</span></h1>
    <div class="grid" id="grid"></div>
    <button onclick="resetCard()">Reset Card</button>
    <div id="stars">Stars: 0</div>
    <div id="win">Congratulations! Full Bingo! üèÜ</div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const player = params.get('player') || '1';
        const data = atob(params.get('data') || '');
        const code = params.get('code') || 'default';

        document.getElementById('player').textContent = player;

        const phrases = data.split('|');
        const grid = document.getElementById('grid');

        for (let i = 0; i < 25; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.textContent = i === 12 ? 'FREE' : (phrases[i] || '?');
            if (i === 12) cell.classList.add('marked');

            cell.onclick = () => {
                cell.classList.toggle('marked');
                checkAlmostBingo();
                checkWin();
                saveMarks();
            };

            grid.appendChild(cell);
        }

        let almostBingoCount = 0;
        let completedRows = new Array(5).fill(false);
        let completedCols = new Array(5).fill(false);
        const stars = document.getElementById('stars');

        function checkAlmostBingo() {
            const cells = Array.from(grid.children);
            const rows = [[0,1,2,3,4], [5,6,7,8,9], [10,11,12,13,14], [15,16,17,18,19], [20,21,22,23,24]];
            const cols = [[0,5,10,15,20], [1,6,11,16,21], [2,7,12,17,22], [3,8,13,18,23], [4,9,14,19,24]];

            let newAlmost = 0;

            rows.forEach((line, index) => {
                if (line.every(idx => cells[idx].classList.contains('marked')) && !completedRows[index]) {
                    newAlmost++;
                    completedRows[index] = true;
                }
            });

            cols.forEach((line, index) => {
                if (line.every(idx => cells[idx].classList.contains('marked')) && !completedCols[index]) {
                    newAlmost++;
                    completedCols[index] = true;
                }
            });

            if (newAlmost > 0) {
                almostBingoCount += newAlmost;
                alert(`Star! Almost Bingo! (${almostBingoCount} stars)`);
                stars.textContent = `Stars: ${almostBingoCount}`;
            }
        }

        function checkWin() {
            const cells = Array.from(grid.children);
            let isFullBingo = false;

            // Full card check (whole card must be full)
            if (cells.every(cell => cell.classList.contains('marked'))) {
                isFullBingo = true;
            }

            if (isFullBingo) {
                document.getElementById('win').style.display = 'block';
            }
        }

        function saveMarks() {
            const cells = Array.from(grid.children);
            const marks = cells.map(cell => cell.classList.contains('marked'));
            localStorage.setItem(`bingoMarks_${code}_${player}`, JSON.stringify({
                marks: marks,
                stars: almostBingoCount,
                completedRows: completedRows,
                completedCols: completedCols
            }));
        }

        function loadMarks() {
            const saved = localStorage.getItem(`bingoMarks_${code}_${player}`);
            if (saved) {
                const data = JSON.parse(saved);
                const cells = Array.from(grid.children);
                for (let i = 0; i < 25; i++) {
                    if (data.marks[i]) cells[i].classList.add('marked');
                }
                almostBingoCount = data.stars || 0;
                completedRows = data.completedRows || new Array(5).fill(false);
                completedCols = data.completedCols || new Array(5).fill(false);
                stars.textContent = `Stars: ${almostBingoCount}`;
                checkAlmostBingo();
                checkWin();
            }
        }

        function resetCard() {
            localStorage.removeItem(`bingoMarks_${code}_${player}`);
            location.reload();
        }

        loadMarks();
    </script>
</body>
</html>
